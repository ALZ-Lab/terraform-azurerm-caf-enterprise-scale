---
name: "Tests (Update)"

trigger: none

pool:
  vmImage: ubuntu-20.04

variables:
  - group: csu-tf-environment

jobs:
  - job: update_opa_baseline
    displayName: "Update OPA baseline"
    steps:
      - task: Bash@3
        displayName: "[az login]"
        inputs:
          targetType: "inline"
          script: "make az-login"
        env:
          ARM_CLIENT_SECRET: $(ARM_CLIENT_SECRET)

      - task: PowerShell@2
        displayName: "[opa values generator]"
        inputs:
          targetType: "inline"
          script: "make opa-values-generator"
        working-directory: $(Build.Repository.LocalPath)/tests/scripts

      - task: Bash@3
        displayName: "[git merge changes]"
        inputs:
          targetType: "inline"
          script: "make git-merge-changes"
